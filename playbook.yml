---
- name: "PLAYBOOK LEX - ORQUESTRAÃ‡ÃƒO"
  hosts: "{{ hostname | default('localhost') }}"
  gather_facts: false
  become: false
  vars_files:
    - vars/main.yml

  tasks:

    - name: "ğŸ§¾ Listar todos os bots"
      shell: ./scripts/list-bots.sh
      register: list_bots_output
      changed_when: false
      tags: list_bots

    - name: "ğŸ” Exibir bots disponÃ­veis"
      debug:
        var: list_bots_output.stdout_lines
      tags: list_bots
    
    - name: "ğŸ¯ Selecionar o bot desejado"
      pause:
        prompt: "Digite o nome exato do bot que vocÃª quer selecionar:"
      register: selected_bot
      tags: list_bots

    - name: "âœ… Bot selecionado"
      debug:
        msg: "VocÃª selecionou o bot: {{ selected_bot.user_input }}"
      tags: list_bots

    - name: "ğŸ“Œ Salvar bot escolhido"
      set_fact:
        bot_name_selected: "{{ selected_bot.user_input }}"

    - name: "ğŸ“¦ Exportar bot escolhido"
      shell: ./scripts/export-bot.sh "{{ bot_name_selected }}"
      when: export_enabled | default(false)
      tags: export_bot
    
    - name: "ğŸ“‚ Verificar se o bot foi exportado"
      stat:
        path: "bot-export.zip"
      register: export_check
      when: export_enabled | default(false)

    - name: "ğŸ“‹ Exibir resultado da exportaÃ§Ã£o
      debug:
        msg: "O bot foi exportado com sucesso: {{ export_check.stat.exists }}"
      when: export_enabled | default(false)
      tags: export_bot
    
    - name: "ğŸ“¥ Verificar se o bot exportado existe"
      stat:
        path: "bot-export.zip"
      register: import_check
      when: import_enabled | default(false)
      tags: import_bot
    
    - name: "ğŸ“¥ Importar bot exportado"
      shell: ./scripts/import-bot.sh
      when: import_enabled | default(false)
      tags: import_bot

    - name: "ğŸš€ Fazer deploy do bot (versÃ£o + alias)"
      shell: ./scripts/post-import-bot.sh
      when: deploy_enabled | default(false)
      tags: deploy_bot
